# Kubernetes Port Forward Helper

Kubernetes 클러스터의 여러 컨텍스트에서 Pod 포트포워딩을 시각적으로 관리할 수 있는 데스크톱 애플리케이션입니다. kubectl 명령어를 직접 입력할 필요 없이 GUI를 통해 여러 클러스터의 포트포워딩을 쉽게 관리할 수 있습니다.

## 개요

이 애플리케이션은 여러 Kubernetes 클러스터 컨텍스트를 한 화면에서 관리하고, 각 컨텍스트의 네임스페이스와 Pod에 대한 포트포워딩을 쉽게 설정하고 해제할 수 있도록 도와줍니다. 복잡한 kubectl 명령어를 기억할 필요 없이 클릭 몇 번으로 포트포워딩을 관리할 수 있습니다.

## 시스템 요구사항

- Node.js 18.0.0 이상
- kubectl이 시스템에 설치되어 있고 PATH에 등록되어 있어야 함
- macOS, Windows, Linux 지원

## 설치 및 실행

### 1. 저장소 클론 및 의존성 설치

```bash
git clone <repository-url>
cd port-forward-helper
npm install
```

### 2. 환경 변수 설정

프로젝트 루트에 `.env` 파일을 생성하고 다음 형식으로 설정합니다:

```
VITE_ALLOWED_NAMESPACES=namespace1,namespace2:8080,namespace3:9090
```

- 네임스페이스는 쉼표로 구분합니다
- 네임스페이스 뒤에 콜론과 포트 번호를 붙이면 해당 네임스페이스의 기본 포트로 설정됩니다
- 예: `ov:9090`은 ov 네임스페이스의 기본 포트를 9090으로 설정합니다
- 포트 번호가 없으면 컨테이너 포트를 기본값으로 사용합니다

### 3. 실행

개발 모드로 실행:

```bash
npm run dev
```

프로덕션 빌드:

```bash
npm run build
npm run preview
```

환경 변수를 변경한 경우 애플리케이션을 재시작해야 변경사항이 적용됩니다.

## 주요 기능

### 다중 컨텍스트 관리

여러 Kubernetes 클러스터 컨텍스트를 탭으로 구분하여 관리합니다. 상단의 컨텍스트 탭을 클릭하여 전환할 수 있으며, 현재 활성화된 컨텍스트는 "Current" 배지로 표시됩니다.

**사용 방법:**
- 상단의 컨텍스트 탭을 클릭하여 원하는 클러스터로 전환합니다
- 컨텍스트 탭 옆의 새로고침 버튼을 클릭하여 최신 정보를 가져옵니다

### 네임스페이스 필터링

왼쪽 사이드바에서 네임스페이스 목록을 관리합니다. `.env` 파일에 설정한 허용된 네임스페이스만 표시되며, 선택한 네임스페이스의 Pod만 로드하여 성능을 최적화합니다.

**사용 방법:**
- 네임스페이스 버튼을 클릭하여 해당 네임스페이스의 Pod 목록을 보이거나 숨깁니다
- "all" 버튼을 클릭하여 모든 허용된 네임스페이스를 한 번에 선택합니다
- "clear" 버튼을 클릭하여 모든 네임스페이스를 해제합니다
- "View {namespace} only" 버튼을 클릭하여 특정 네임스페이스만 선택합니다
- 네임스페이스 영역은 접기/펼치기 버튼으로 공간을 절약할 수 있습니다

### Pod 포트포워딩 관리

메인 영역에서 각 Pod의 포트 정보를 확인하고 포트포워딩을 설정합니다. FAILED 상태이거나 포트가 없는 Pod는 자동으로 필터링됩니다.

**사용 방법:**
- 각 Pod의 포트 정보를 확인합니다 (포트 번호, 이름, 프로토콜)
- 로컬 포트 입력 필드에 외부에서 접근할 포트 번호를 입력합니다
- 포트포워딩 행을 클릭하여 활성화 또는 비활성화합니다
- 활성 상태는 초록색으로, 비활성 상태는 회색으로 표시됩니다
- 로컬 포트 입력 필드를 클릭하면 행 전체가 토글되지 않습니다

**네임스페이스 기본 포트:**
- `.env` 파일에서 `namespace:port` 형식으로 설정한 기본 포트가 자동으로 적용됩니다
- 예: `ov:9090`으로 설정하면 ov 네임스페이스의 Pod는 기본적으로 9090 포트를 사용합니다

**자동 포트 찾기:**
- 기본 포트가 이미 사용 중이면 자동으로 사용 가능한 다음 포트를 찾아 할당합니다
- 최대 65535까지 시도하며, 사용 가능한 포트를 찾지 못하면 알림을 표시합니다

### 활성 포트포워딩 표시 및 관리

오른쪽 사이드바에서 현재 활성화된 모든 포트포워딩을 한눈에 확인할 수 있습니다. 컨텍스트 구분 없이 모든 활성 포트포워딩이 외부 포트 번호 순으로 정렬되어 표시됩니다.

**사용 방법:**
- 활성 포트포워딩 목록에서 각 항목의 정보를 확인합니다 (프로토콜, 컨텍스트, 네임스페이스, Pod 이름, 외부 포트, 내부 포트)
- 특정 활성 포트포워딩에 마우스를 올리면 오른쪽 위에 X 버튼이 나타납니다
- X 버튼을 클릭하여 해당 포트포워딩을 비활성화합니다
- 활성 포트포워딩 항목을 클릭하면 메인 영역에서 해당 Pod의 포트포워딩 행으로 자동 스크롤됩니다
- 외부 포트 번호를 클릭하면 인라인으로 수정할 수 있습니다
- "Disable All" 버튼을 클릭하여 모든 활성 포트포워딩을 한 번에 비활성화합니다

**포트 수정:**
- 활성 포트포워딩 영역에서 외부 포트 번호를 클릭하면 수정 모드로 전환됩니다
- 새로운 포트 번호를 입력하고 Enter 키를 누르거나 입력 필드 밖을 클릭하면 적용됩니다
- ESC 키를 누르면 취소됩니다
- 포트 번호가 변경되면 기존 포트포워딩이 중지되고 새로운 포트로 재시작됩니다
- 중복된 포트 번호를 사용하려고 하면 알림이 표시되고 수정이 취소됩니다

## 기술 스택

### Electron

데스크톱 애플리케이션을 만들기 위해 Electron을 사용했습니다. Electron은 웹 기술(HTML, CSS, JavaScript)로 네이티브 데스크톱 애플리케이션을 만들 수 있게 해주는 프레임워크입니다. 하나의 코드베이스로 Windows, macOS, Linux를 모두 지원할 수 있습니다.

### React

사용자 인터페이스를 만들기 위해 React를 사용했습니다. React는 컴포넌트 기반으로 UI를 구성할 수 있어 복잡한 인터페이스를 쉽게 관리할 수 있습니다. 상태 관리와 UI 업데이트를 효율적으로 처리할 수 있습니다.

### TypeScript

타입 안정성을 위해 TypeScript를 사용했습니다. TypeScript는 JavaScript에 타입을 추가한 언어로, 코드 작성 시 오류를 미리 발견할 수 있어 안정적인 개발이 가능합니다.

### Vite

빌드 도구로 Vite를 사용했습니다. Vite는 매우 빠른 개발 서버와 빌드 속도를 제공합니다. 코드 변경 시 즉시 반영되어 개발 효율이 높습니다.

### electron-vite

Electron과 Vite를 통합하는 빌드 도구입니다. Electron의 메인 프로세스, 렌더러 프로세스, preload 스크립트를 각각 빌드하고 관리할 수 있게 해줍니다.

## 애플리케이션 구조

애플리케이션은 크게 세 부분으로 나뉩니다:

### Electron 메인 프로세스

`electron/main.ts` 파일이 메인 프로세스를 담당합니다. 이 프로세스는 시스템 리소스에 직접 접근할 수 있어 kubectl 명령어를 실행합니다. 보안을 위해 렌더러 프로세스에서는 직접 시스템 명령어를 실행할 수 없고, IPC(Inter-Process Communication)를 통해 메인 프로세스에 요청을 보냅니다.

### React 렌더러 프로세스

`src/` 디렉토리의 React 코드가 렌더러 프로세스를 담당합니다. 사용자가 보는 화면을 렌더링하고 사용자 입력을 처리합니다. 메인 프로세스와 통신하여 kubectl 명령어 실행을 요청합니다.

### Preload 스크립트

`electron/preload.ts` 파일이 보안 브릿지 역할을 합니다. 렌더러 프로세스에서 안전하게 메인 프로세스의 기능을 사용할 수 있도록 API를 노출합니다.

## 작동 원리

### kubectl 명령어 실행

애플리케이션은 Electron의 메인 프로세스에서 `child_process`를 사용하여 kubectl 명령어를 실행합니다. React 컴포넌트에서 `window.electronAPI.execKubectl()`을 호출하면, preload 스크립트를 통해 메인 프로세스에 요청이 전달되고, 메인 프로세스가 실제 kubectl 명령어를 실행한 후 결과를 반환합니다.

### 포트포워딩 프로세스 관리

포트포워딩은 `kubectl port-forward` 명령어를 백그라운드 프로세스로 실행하여 관리합니다. 각 포트포워딩 프로세스의 PID를 추적하여 필요 시 종료할 수 있습니다. 애플리케이션이 종료될 때 모든 포트포워딩 프로세스도 자동으로 종료됩니다.

### 지연 로딩 및 병렬 처리

성능 최적화를 위해 지연 로딩과 병렬 처리를 사용합니다. 컨텍스트 변경 시 네임스페이스 목록만 먼저 로드하고, Pod는 사용자가 네임스페이스를 선택했을 때만 로드합니다. 여러 네임스페이스를 선택하면 모든 네임스페이스의 Pod를 동시에 로드하여 빠르게 처리합니다.

### 상태 관리

React의 useState와 useMemo를 사용하여 애플리케이션 상태를 관리합니다. 컨텍스트 목록, 네임스페이스 목록, Pod 목록, 포트포워딩 설정 등을 계층적으로 관리하여 효율적으로 데이터를 처리합니다.

### 포트 중복 방지

모든 활성 포트포워딩의 외부 포트를 추적하여 중복을 방지합니다. 새로운 포트포워딩을 활성화하거나 포트를 수정할 때 이미 사용 중인 포트인지 확인하고, 중복이면 알림을 표시하고 작업을 중단합니다.

### 자동 포트 찾기

기본 포트가 이미 사용 중일 때 자동으로 사용 가능한 다음 포트를 찾습니다. 기본 포트부터 시작하여 65535까지 순차적으로 확인하며, 사용 가능한 첫 번째 포트를 할당합니다.

## 문제 해결

### 애플리케이션이 시작되지 않습니다

빌드 파일이 없거나 잘못된 경우 다음 명령어로 재빌드합니다:

```bash
rm -rf out dist-electron dist
npm run dev
```

### kubectl을 찾을 수 없습니다

kubectl이 설치되어 있고 PATH에 등록되어 있는지 확인합니다:

```bash
which kubectl
kubectl version --client
```

### 컨텍스트를 조회할 수 없습니다

kubectl 설정 파일이 올바른 위치에 있는지 확인합니다:

```bash
kubectl config get-contexts
```

### 포트포워딩이 시작되지 않습니다

Pod가 실행 중인지, 로컬 포트가 이미 사용 중인지 확인합니다:

```bash
kubectl --context <context-name> get pods -n <namespace>
lsof -i :<port-number>
```

## 라이선스

MIT
